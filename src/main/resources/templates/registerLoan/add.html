<!doctype html>
<html lang="vi">
<head th:replace="head.html :: head('Đăng ký vay lãi | N4Bank')"></head>
<body>

<style>
        .img-identity {
            width: 50%;
            aspect-ratio: 1/0.8;
            max-height: 200px;
        }

        .identityImgBox {
            height: 240px;
            border: 1px solid #ccc;
        }

</style>

<div th:replace="header.html :: header"></div>

<!--Nội dung-->
<div class="container mt-4" id="body">
    <form id="registerLoanForm" action="" method="post" th:object="${registerLoanForm}" th:action="@{/loans/add}">
        <input type="hidden" name="registerLoanAction" value="1" id="inputRegisterLoanAction">
        <div class="d-flex align-items-center justify-content-between mb-3 sticky-top bg-white py-2">
            <h2 class="fs-4">Đăng ký vay lãi</h2>
            <div>
                <button class="btn btn-primary" type="submit" id="btnSubmit">Gửi</button>
                <button class="btn btn-success ms-2" id="btnSave">Lưu</button>
            </div>
        </div>


        <div class="card">
            <div class="card-body">
                <div class="card-title fw-bold mb-3 bg-primary text-white p-3">Thông tin khách hàng</div>

                <div class="row">
                    <div class="col-sm-6">
                        <div class="mb-3">
                            <label for="lastName">Họ và tên đệm (<span class="text-danger">*</span>)</label>
                            <input type="text" class="form-control" id="lastName" th:field="*{lastName}"
                                   th:classappend="${#fields.hasErrors('lastName')} ? is-invalid : ''" autofocus>
                            <span th:if="${#fields.hasErrors('lastName')}" th:errors="*{lastName}"
                                  class="invalid-feedback">LastName Error</span>
                        </div>
                    </div>

                    <div class="col-sm-6">
                        <div class="mb-3">
                            <label for="firstName">Tên (<span class="text-danger">*</span>)</label>
                            <input type="text" class="form-control" id="firstName" th:field="*{firstName}"
                                   th:classappend="${#fields.hasErrors('firstName')} ? is-invalid : ''">
                            <span th:if="${#fields.hasErrors('firstName')}" th:errors="*{firstName}"
                                  class="invalid-feedback">FirstName Error</span>
                        </div>
                    </div>

                    <div class="col-sm-6">
                        <div class="mb-3">
                            <label for="gender">Giới tính (<span class="text-danger">*</span>)</label>
                            <select id="gender" class="form-select" th:field="*{gender}"
                                    th:classappend="${#fields.hasErrors('gender')} ? is-invalid : ''">
                                <option value="1">Nam</option>
                                <option value="2">Nữ</option>
                                <option value="3">Khác</option>
                            </select>
                            <span th:if="${#fields.hasErrors('gender')}" th:errors="*{gender}" class="invalid-feedback">LastName Error</span>
                        </div>
                    </div>

                    <div class="col-sm-6">
                        <div class="mb-3">
                            <label for="dateOfBirth">Ngày sinh (<span class="text-danger">*</span>)</label>
                            <input type="date" class="form-control" id="dateOfBirth" th:field="*{dateOfBirth}"
                                   th:classappend="${#fields.hasErrors('dateOfBirth')} ? is-invalid : ''">
                            <span th:if="${#fields.hasErrors('dateOfBirth')}" th:errors="*{dateOfBirth}"
                                  class="invalid-feedback">DateOfBirth Error</span>
                        </div>
                    </div>

                    <div class="col-sm-4">
                        <div class="mb-3">
                            <label for="identityNumber">Số CMND/CCCD (<span class="text-danger">*</span>)</label>
                            <input type="text" class="form-control" th:field="*{identityNumber}" id="identityNumber"
                                   th:classappend="${#fields.hasErrors('identityNumber')} ? is-invalid : ''">
                            <span th:if="${#fields.hasErrors('identityNumber')}" th:errors="*{identityNumber}"
                                  class="invalid-feedback">IdentityNumber Error</span>
                        </div>
                    </div>

                    <div class="col-sm-4">
                        <div class="mb-3">
                            <label for="identityDate">Ngày cấp (<span class="text-danger">*</span>)</label>
                            <input type="date" class="form-control" th:field="*{identityDate}" id="identityDate"
                                   th:classappend="${#fields.hasErrors('identityDate')} ? is-invalid : ''">
                            <span th:if="${#fields.hasErrors('identityDate')}" th:errors="*{identityDate}"
                                  class="invalid-feedback">IdentityDate Error</span>
                        </div>
                    </div>

                    <div class="col-sm-4">
                        <div class="mb-3">
                            <label for="identityAddress">Nơi cấp (<span class="text-danger">*</span>)</label>
                            <input type="text" class="form-control" th:field="*{identityAddress}" id="identityAddress"
                                   th:classappend="${#fields.hasErrors('identityAddress')} ? is-invalid : ''">
                            <span th:if="${#fields.hasErrors('identityAddress')}" th:errors="*{identityAddress}"
                                  class="invalid-feedback">IdentityAddress Error</span>
                        </div>
                    </div>

                    <div class="col-sm-6">
                        <div class="mb-3">
                            <label for="identityFrontFile">Ảnh CMND/CCCD mặt trước (<span class="text-danger">*</span>)</label>
                            <input type="file" id="identityFrontFile" class="d-none">
                            <input type="hidden" id="identityFront" th:field="*{identityFront}"
                                   th:classappend="${#fields.hasErrors('identityFront')} ? is-invalid : ''">
                            <button class="btn btn-primary" id="identityFrontBtnUpload">Tải lên</button>
                            <div id="identityFrontImg" class="identityImgBox mt-3 p-2">

                            </div>
                            <span th:if="${#fields.hasErrors('identityFront')}" th:errors="*{identityFront}"
                                  class="invalid-feedback">IdentityFront Error</span>
                        </div>
                    </div>

                    <div class="col-sm-6">
                        <div class="mb-3">
                            <label for="identityBackFile">Ảnh CMND/CCCD mặt sau (<span
                                    class="text-danger">*</span>)</label>
                            <input type="file" class="d-none" id="identityBackFile">
                            <input type="hidden" id="identityBack" th:field="*{identityBack}"
                                   th:classappend="${#fields.hasErrors('identityBack')} ? is-invalid : ''">
                            <button class="btn btn-primary" id="identityBackBtnUpload">Tải lên</button>
                            <div id="identityBackImg" class="identityImgBox mt-3 p-2"></div>
                            <span th:if="${#fields.hasErrors('identityBack')}" th:errors="*{identityBack}"
                                  class="invalid-feedback">IdentityBack Error</span>
                        </div>
                    </div>

                    <div class="col-sm-4">
                        <div class="mb-3">
                            <label for="province">Tỉnh/Thành phố (<span class="text-danger">*</span>)</label>
                            <input type="text" id="province" class="form-control" th:field="*{province}"
                                   th:classappend="${#fields.hasErrors('province')} ? is-invalid : ''">
                            <span th:if="${#fields.hasErrors('province')}" th:errors="*{province}"
                                  class="invalid-feedback">Province Error</span>
                        </div>
                    </div>

                    <div class="col-sm-4">
                        <div class="mb-3">
                            <label for="district">Quận/Huyện (<span class="text-danger">*</span>)</label>
                            <input type="text" class="form-control" id="district" th:field="*{district}"
                                   th:classappend="${#fields.hasErrors('district')} ? is-invalid : ''">
                            <span th:if="${#fields.hasErrors('district')}" th:errors="*{district}"
                                  class="invalid-feedback">District Error</span>
                        </div>
                    </div>

                    <div class="col-sm-4">
                        <div class="mb-3">
                            <label for="wards">Phường/Xã (<span class="text-danger">*</span>)</label>
                            <input type="text" class="form-control" id="wards" th:field="*{wards}"
                                   th:classappend="${#fields.hasErrors('wards')} ? is-invalid : ''">
                            <span th:if="${#fields.hasErrors('wards')}" th:errors="*{wards}"
                                  class="invalid-feedback">Wards Error</span>
                        </div>
                    </div>

                    <div class="col-sm-6">
                        <div class="mb-3">
                            <label for="phoneNumber">Số điện thoại (<span class="text-danger">*</span>)</label>
                            <input type="text" class="form-control" id="phoneNumber" th:field="*{phoneNumber}"
                                   th:classappend="${#fields.hasErrors('phoneNumber')} ? is-invalid : ''">
                            <span th:if="${#fields.hasErrors('phoneNumber')}" th:errors="*{phoneNumber}"
                                  class="invalid-feedback">PhoneNumber Error</span>
                        </div>
                    </div>

                    <div class="col-sm-6">
                        <div class="mb-3">
                            <label for="email">Email</label>
                            <input type="text" class="form-control" id="email" th:field="*{email}"
                                   th:classappend="${#fields.hasErrors('email')} ? is-invalid : ''">
                            <span th:if="${#fields.hasErrors('email')}" th:errors="*{email}"
                                  class="invalid-feedback">Email Error</span>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-body">
                <div class="card-title fw-bold mb-3 bg-primary text-white p-3">Thế chấp</div>
                <div class="mb-3">
                    <label for="paperType">Loại giấy tờ</label>
                    <select id="paperType" class="form-select" th:field="*{paperType}"
                            th:classappend="${#fields.hasErrors('paperType')} ? is-invalid : ''" th:utext="${registerLoanForm.paperTypeHtml}"></select>
                    <span th:if="${#fields.hasErrors('paperType')}" th:errors="*{paperType}"
                          class="invalid-feedback">PaperType Error</span>
                </div>

                <div class="mb-3">
                    <label for="paperImg">Ảnh giấy tờ</label>
                    <input type="file" class="d-none" id="paperImgFile">
                    <input type="hidden" id="paperImg" th:field="*{paperImg}"
                           th:classappend="${#fields.hasErrors('paperImg')} ? is-invalid : ''">
                    <button class="btn btn-primary" id="paperImgBtnUpload">Tải lên</button>
                    <div id="paperImgBox" class="identityImgBox mt-3 p-2"></div>
                    <span th:if="${#fields.hasErrors('paperImg')}" th:errors="*{paperImg}"
                          class="invalid-feedback">PaperImg Error</span>
                </div>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-body">
                <div class="card-title fw-bold mb-3 bg-primary text-white p-3">Thông tin vay lãi</div>
                <div class="mb-3">
                    <label for="amount">Số tiền (<span class="text-danger">*</span>) - Tối thiểu là 1.000.000 VNĐ</label>
                    <input type="number" class="form-control" id="amount" th:field="*{amount}"
                           th:classappend="${#fields.hasErrors('amount')} ? is-invalid : ''">
                    <span th:if="${#fields.hasErrors('amount')}" th:errors="*{amount}"
                          class="invalid-feedback">Amount Error</span>
                </div>

                <div class="mb-3">
                    <label for="cycle">Kỳ hạn vay</label>
                    <select id="cycle" class="form-select" th:field="*{cycle}"
                            th:classappend="${#fields.hasErrors('cycle')} ? is-invalid : ''">
                        <option value="1">1 Tháng</option>
                        <option value="2">3 Tháng</option>
                        <option value="3">6 Tháng</option>
                        <option value="4">1 Năm</option>
                        <option value="5">1 Năm 6 Tháng</option>
                        <option value="6">2 Năm</option>
                        <option value="7">2 Năm 6 Tháng</option>
                        <option value="8">3 Năm</option>
                    </select>
                    <span th:if="${#fields.hasErrors('cycle')}" th:errors="*{cycle}"
                          class="invalid-feedback">Cycle Error</span>
                </div>
            </div>
        </div>

    </form>

</div>

<div th:replace="footer.html :: footer"></div>

<!-- Optional JavaScript; choose one of the two! -->

<!-- Option 1: Bootstrap Bundle with Popper -->
<script src="/js/bootstrap.min.js"></script>
<!-- Option 2: Separate Popper and Bootstrap JS -->
<!--
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
-->

<script>
    let identityFrontFile = document.getElementById('identityFrontFile');
        let identityFrontImg = document.getElementById("identityFrontImg");
        let identityFront = document.getElementById('identityFront');
        let identityFrontBtnUpload = document.getElementById('identityFrontBtnUpload');
        identityFrontBtnUpload.addEventListener('click', function (e) {
            e.preventDefault();
            identityFrontFile.click();
        });
        identityFrontFile.addEventListener('change', function (e) {
            e.preventDefault();
            let file = e.target.files[0];
            // upload file
            let formData = new FormData();
            formData.append('file', file);
            fetch('/files', {
                body: formData,
                method: 'post'
            }).then(res => res.json())
                .then(data => {
                    let fileName = data[0];
                    identityFront.setAttribute('value', fileName);
                    let urlImg = `/files?fileName=${fileName}`;
                    identityFrontImg.innerHTML = `<img src=${urlImg} class="img-identity" />`;
                })
                .catch(err => console.log(err));
        });

        let identityBackFile = document.getElementById('identityBackFile');
        let identityBackImg = document.getElementById("identityBackImg");
        let identityBack = document.getElementById('identityBack');
        let identityBackBtnUpload = document.getElementById('identityBackBtnUpload');
        identityBackBtnUpload.addEventListener('click', function (e) {
            e.preventDefault();
            identityBackFile.click();
        });
        identityBackFile.addEventListener('change', function (e) {
            e.preventDefault();
            let file = e.target.files[0];

            // upload file
            let formData = new FormData();
            formData.append('file', file);
            fetch('/files', {
                body: formData,
                method: 'post'
            }).then(res => res.json())
                .then(data => {
                    let fileName = data[0];
                    identityBack.setAttribute('value', fileName);
                     let urlImg = `/files?fileName=${fileName}`;
                    identityBackImg.innerHTML = `<img src=${urlImg} class="img-identity" />`;
                })
                .catch(err => console.log(err));
        });

        let paperImgFile = document.getElementById('paperImgFile');
        let paperImgBtnUpload = document.getElementById('paperImgBtnUpload');
        let paperImg = document.getElementById('paperImg');
        let paperImgBox = document.getElementById('paperImgBox');

        paperImgBtnUpload.addEventListener('click', function (e) {
            e.preventDefault();
            paperImgFile.click();
        });

        paperImgFile.addEventListener('change', function (e) {
            e.preventDefault();
            let file = e.target.files[0];

            // upload file
            let formData = new FormData();
            formData.append('file', file);
            fetch('/files', {
                body: formData,
                method: 'post'
            }).then(res => res.json())
                .then(data => {
                    let fileName = data[0];
                    paperImg.setAttribute('value', fileName);
                    let urlImg = `/files?fileName=${fileName}`;
                    paperImgBox.innerHTML = `<img src=${urlImg} class="img-identity" />`;
                })
                .catch(err => console.log(err));
        });

    let btnSave = document.getElementById('btnSave');
    let btnSubmit = document.getElementById('btnSubmit');
    let inputRegisterLoanAction = document.getElementById('inputRegisterLoanAction');
    let registerLoanForm = document.getElementById('registerLoanForm');
    window.onload = function(){
        btnSave.addEventListener('click', function(e){
            inputRegisterLoanAction.value = 2;
            registerLoanForm.submit();
        });

        btnSubmit.addEventListener('click', function(e){
            inputRegisterLoanAction.value = 1;
            registerLoanForm.submit();
        });
    }




</script>
</body>
</html>